# =========================================
# Veracode Configuration File (.veracode.yml)
# Proyecto: Node.js
# Estrategia de ramas:
#   - feature/* : Pipeline Scan + SCA
#   - develop   : Sandbox Scan + SCA
#   - main      : Upload & Policy Scan
# =========================================

# --- 1Ô∏è‚É£ FEATURE BRANCHES: Pipeline Scan + SCA ---
veracode_pipeline_scan_feature:
  push:
    trigger: true
    branches_to_run:
      - 'feature/*'
  pull_request:
    trigger: true
    action:
      - opened
      - synchronize
    target_branch:
      - develop
  analysis_on_platform: false
  break_build_on_error: true
  break_build_policy_findings: false
  policy: 'Veracode Recommended Medium + SCA'
  create_code_scanning_alert: true
  create_issue: false
  error_message: "‚ùå Pipeline Scan fall√≥. Revisa los findings en el artefacto del workflow."
  issues:
    trigger: false

veracode_sca_scan_feature:
  push:
    trigger: true
    branches_to_run:
      - 'feature/*'
  break_build_on_error: true
  create_code_scanning_alert: true
  create_issue: false
  error_message: "‚ùå SCA Scan fall√≥ en rama feature."

# --- 2Ô∏è‚É£ DEVELOP BRANCH: Sandbox Scan + SCA ---
veracode_sandbox_scan_develop:
  push:
    trigger: true
    branches_to_run:
      - develop
  analysis_on_platform: true        # Subir resultados al sandbox Veracode
  break_build_on_error: true
  break_build_policy_findings: true
  policy: 'Veracode Recommended Medium + SCA'
  create_code_scanning_alert: true
  create_issue: false
  error_message: "‚ö†Ô∏è Sandbox scan fall√≥ en develop. Revisa los resultados en Veracode."
  issues:
    trigger: false

veracode_sca_scan_develop:
  push:
    trigger: true
    branches_to_run:
      - develop
  break_build_on_error: true
  create_code_scanning_alert: true
  create_issue: false
  error_message: "‚ùå SCA Scan fall√≥ en develop."

# --- 3Ô∏è‚É£ MAIN BRANCH: Upload & Policy Scan ---
veracode_policy_scan_main:
  push:
    trigger: true
    branches_to_run:
      - main
  pull_request:
    trigger: true
    target_branch:
      - main
  analysis_on_platform: true        # Resultados oficiales en la app Veracode
  break_build_on_error: true
  break_build_policy_findings: true
  break_build_invalid_policy: true
  policy: 'Veracode Recommended Medium + SCA'
  create_code_scanning_alert: true
  create_issue: false
  error_message: "üö´ Policy scan fall√≥. Corrige vulnerabilidades cr√≠ticas antes del merge."
  issues:
    trigger: false